<Module>
<ModulePrefs title="Lemon Games | Eaglercraft"/>
<Content type="html">
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lemon Games</title>
<style>
html, body { 
  margin:0; 
  padding:0; 
  width:100%; 
  height:100%; 
  font-family:'Poppins',sans-serif; 
  overflow:hidden; 
  background:#0d0d0d; 
  color:#fff; 
}

#menu { 
  position:absolute; 
  top:0; 
  left:0; 
  width:100%; 
  height:100%; 
  display:flex; 
  flex-direction:column; 
  justify-content:center; 
  align-items:center; 
  z-index:10; 
  background:#0d0d0d; 
}

#menu.hidden { 
  display:none; 
}

h1 { 
  font-size:3rem; 
  margin-bottom:2rem; 
}

.play-button { 
  padding:1rem 3rem; 
  font-size:1.5rem; 
  font-weight:700; 
  border:none; 
  border-radius:10px; 
  cursor:pointer; 
  background:#3cafff; 
  color:#fff; 
}

.play-button:hover { 
  background:#2a9ae6; 
}

/* Live Counter */
.live-counter { 
  position:fixed; 
  top:20px; 
  right:20px; 
  background:rgba(0,0,0,0.8); 
  padding:10px 16px; 
  border-radius:20px; 
  display:flex; 
  align-items:center; 
  gap:8px; 
  z-index:9999; 
  border:1px solid rgba(255,255,255,0.1);
}

.live-dot { 
  width:10px; 
  height:10px; 
  background:#ff3030; 
  border-radius:50%; 
  animation:pulse 2s ease-in-out infinite; 
}

@keyframes pulse { 
  0%, 100% { opacity:1; } 
  50% { opacity:0.5; } 
}

.counter-text { 
  font-size:0.85rem; 
  font-weight:600; 
  color:#fff; 
}

.counter-number { 
  color:#3cafff; 
  margin-left:3px; 
}

#loading { 
  position:absolute; 
  top:0; 
  left:0; 
  width:100%; 
  height:100%; 
  background:#111; 
  display:none; 
  flex-direction:column; 
  justify-content:center; 
  align-items:center; 
  z-index:9; 
}

.spinner { 
  width:50px; 
  height:50px; 
  border:4px solid rgba(255,255,255,0.1); 
  border-top-color:#3cafff; 
  border-radius:50%; 
  animation:spin 0.8s linear infinite; 
  margin-bottom:15px; 
}

@keyframes spin { 
  to { transform:rotate(360deg); } 
}

.loading-text { 
  font-size:1.2rem; 
  color:#aaa; 
  font-weight:600; 
}

#game_frame { 
  width:100%; 
  height:100%; 
  display:none; 
  background:#000; 
}

/* Watermark */
.watermark { 
  position:fixed; 
  bottom:15px; 
  left:50%; 
  transform:translateX(-50%); 
  font-size:0.85rem; 
  font-weight:600; 
  color:rgba(255,255,255,0.3); 
  z-index:9999; 
  pointer-events:none; 
  letter-spacing:1px; 
}
</style>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/mece188/feh@main/classes.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/mece188/feh@main/fix-webm-duration.js"></script>
</head>
<body>

<div id="menu">
  <h1>üçã Lemon Games</h1>
  <button class="play-button" id="playBtn">‚ñ∂ Play</button>
</div>

<div class="live-counter">
  <div class="live-dot"></div>
  <span class="counter-text">Online: <span class="counter-number" id="playerCount">...</span></span>
</div>

<div id="loading">
  <div class="spinner"></div>
  <div class="loading-text">Loading Eaglercraft...</div>
</div>

<div id="game_frame"></div>

<div class="watermark">LEMON GAMES</div>

<script>
// Live visitor counter - simplified and more reliable
const VISITORS_KEY = 'lemon-live-count';
const MY_ID = Date.now() + '-' + Math.random().toString(36).substr(2);
let counterInterval;

async function syncVisitors() {
  try {
    let data = {};
    
    // Get current data
    try {
      const result = await window.storage.get(VISITORS_KEY, true);
      if (result && result.value) {
        data = JSON.parse(result.value);
      }
    } catch (e) {
      data = {};
    }

    const now = Date.now();
    
    // Clean old entries (older than 8 seconds)
    Object.keys(data).forEach(id => {
      if (now - data[id] > 8000) {
        delete data[id];
      }
    });

    // Add me
    data[MY_ID] = now;

    // Save
    await window.storage.set(VISITORS_KEY, JSON.stringify(data), true);

    // Update UI
    document.getElementById('playerCount').textContent = Object.keys(data).length;
  } catch (err) {
    console.error('Counter error:', err);
    document.getElementById('playerCount').textContent = '?';
  }
}

// Start counter
syncVisitors();
counterInterval = setInterval(syncVisitors, 2500);

// Cleanup on exit
window.addEventListener('beforeunload', () => {
  clearInterval(counterInterval);
});

// Game loading
const playBtn = document.getElementById('playBtn');
const menu = document.getElementById('menu');
const loadingDiv = document.getElementById('loading');
const gameFrame = document.getElementById('game_frame');

playBtn.addEventListener('click', () => {
    menu.classList.add('hidden');
    loadingDiv.style.display = 'flex';
    
    setTimeout(() => {
        loadingDiv.style.display = 'none';
        gameFrame.style.display = 'block';

        if(!window.eaglercraftXOpts){
          window.eaglercraftXOpts = {
            container: "game_frame",
            assetsURI: "https://cdn.jsdelivr.net/gh/mece188/feh@main/assets.epk",
            localesURI: "lang/",
            servers: [
              {addr: "wss://mc.arch.lol/", name: "ArchMC"},
              {addr: "wss://mc.asspixel.net", name: "AssPixel"},
              {addr: "wss://sus.shhnowisnottheti.me", name: "Ayunboom"},
              {addr: "wss://aeon-network.net/1.8", name: "Aeon"},
              {addr: "wss://zentic.org/", name: "Zentic"}
            ]
          };
        }

        try { 
          main(); 
        } catch(e) { 
          console.error("Error starting EaglercraftX:", e);
        }
    }, 2000);
});
</script>

</body>
</html>
</Content>
</Module>
